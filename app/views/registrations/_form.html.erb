<%= form_for @registration do |f| %>
  <%= f.hidden_field :event_id, value: params[:event_id] %>
  <%= f.hidden_field :user_id, value: params[:user_id] %>

  <%= f.label :channel %>
  <%= f.select :channel_id, @registration.event.channels.collect { |c| ["#{c.band.name} #{c.name} - #{c.frequency}", c.id]}, {}, {class: "form-control"} %>
  <br>
  <p id="channel_status"></p>
  <br>
  <%= f.label :notes %>
  <%= f.text_area :notes, class: "form-control" %>
  <br>
  <%= f.submit "Register", class: "btn btn-primary" %>
  <%= link_to "Cancel", event_path(@registration.event), class: "btn btn-outline-primary" %>
<% end %>

<script>
  $('#channel_id').on('change', function() {
    $.get("<%= event_check_channel_path(event_id: 'event_id', channel_id: 'channel_id') %>", function(data) {
      if(data.pilots.length > 0) {
        clashes_string = ""
        $.each(data.pilots, function(pilot) {
          if(clashes_string == "") {
            clashes_string = "You will be sharing with: " + pilot.name;
          }
          else {
            clashes_string += ", " + pilot.name;
          }
        });
        $('#channel_status').text(clashes_string);
      }
    });
  });
</script>